# Server Local ğŸ’»

è²¯é‡‘ Quests ã® ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒã‚°ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚

## get started

1. Package ã‚’ install

   ```bash
   npm install
   ```

2. Mysql ã« DB æ§‹ç¯‰

   ```
   source ./sql/create.sql
   ```

3. ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹
   ```bash
   npm run dev
   ```

# API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ãƒ™ãƒ¼ã‚¹ URL

```
http://localhost:3000/api
```

## ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè©³ç´°ã®å–å¾—

**GET** `/accounts/{account_id}`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã®è©³ç´°ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
[
    {
        "account_id": 1,
        "balance": 107000,
        "saving": 500,
        "created_at": "2024-07-17T11:58:07.000Z",
        "updated_at": "2024-07-17T14:18:17.000Z"
    }
]
```

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ®‹é«˜ã®å–å¾—

**GET** `/accounts/{account_id}/balance`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã®æ®‹é«˜ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
{
    "balance": 107000
}

```

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè²¯é‡‘æ®‹é«˜ã®å–å¾—

**GET** `/accounts/{account_id}/saving-balance`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã®è²¯é‡‘æ®‹é«˜ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
{
    "saving": 500
}
```

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå–å¼•å±¥æ­´ã®å–å¾—

**GET** `/accounts/{account_id}/transactions`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã®å–å¼•å±¥æ­´ã‚’å–å¾—ã—ã¾ã™ã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§`type`ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒå¯èƒ½ã§ã™ã€‚

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**

- `type`ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰: -DEPOSIT
  -WITHDRAWAL

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
[
    {
        "transaction_id": 1,
        "amount": 1100,
        "account_id": 1,
        "category_id": 1,
        "member_id": 1,
        "transaction_date": "2023-12-01T01:00:00.000Z",
        "message": "December deposit",
        "transaction_type": "DEPOSIT"
    },
]
```

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœˆæ¬¡æ”¯å‡ºã®å–å¾—

**GET** `/accounts/{account_id}/expense`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã®æœˆæ¬¡æ”¯å‡ºã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
[
    {
        "month_year": "2023-12",
        "spendings": "2125"
    },
    {
        "month_year": "2024-01",
        "spendings": "1060"
    },
    {
        "month_year": "2024-02",
        "spendings": "2120"
    },
    {
        "month_year": "2024-03",
        "spendings": "2145"
    },
    {
        "month_year": "2024-04",
        "spendings": "2125"
    },
    {
        "month_year": "2024-05",
        "spendings": "2145"
    },
    {
        "month_year": "2024-06",
        "spendings": "2130"
    }
]
```

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ”¯å‡ºã‚’è¿½åŠ 

**POST** `/accounts/{account_id}/expense`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã«æ–°ã—ã„æ”¯å‡ºã‚’è¿½åŠ ã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£:**

- `amount`: æ”¯å‡ºé‡‘é¡ï¼ˆå¿…é ˆï¼‰
- `memo`: æ”¯å‡ºãƒ¡ãƒ¢ï¼ˆå¿…é ˆï¼‰
- `categoryId`: æ”¯å‡ºã‚«ãƒ†ã‚´ãƒªãƒ¼ IDï¼ˆå¿…é ˆï¼‰
- `memberId`: æ”¯å‡ºã«é–¢é€£ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ IDï¼ˆå¿…é ˆï¼‰

```JSON
{
    "amount" : 1000,
    "memo" : "test income",
    "memberId" : 1,
    "categoryId" : 1
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
{
    "message": "Expense recorded",
    "balance": 106000
}
```

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœˆæ¬¡åå…¥ã®å–å¾—

**GET** `/accounts/{account_id}/income`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã®æœˆæ¬¡åå…¥ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
[
    {
        "month_year": "2023-12",
        "income": "3450"
    },
    {
        "month_year": "2024-01",
        "income": "4550"
    },
    {
        "month_year": "2024-02",
        "income": "3420"
    },
    {
        "month_year": "2024-03",
        "income": "3325"
    },
    {
        "month_year": "2024-04",
        "income": "3405"
    },
    {
        "month_year": "2024-05",
        "income": "3305"
    },
    {
        "month_year": "2024-06",
        "income": "3350"
    }
]
```

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«åå…¥ã‚’è¿½åŠ 

**POST** `/accounts/{account_id}/income`

ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`account_id`ï¼‰ã«æ–°ã—ã„åå…¥ã‚’è¿½åŠ ã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£:**

- `amount`: åå…¥é‡‘é¡ï¼ˆå¿…é ˆï¼‰
- `memo`: åå…¥ãƒ¡ãƒ¢ï¼ˆå¿…é ˆï¼‰
- `memberId`: åå…¥ã«é–¢é€£ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ IDï¼ˆå¿…é ˆï¼‰

```JSON
{
    "amount" : 1000,
    "memo" : "test income",
    "memberId" : 1
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
{
    "message": "Income recorded",
    "balance": 108000
}
```

### ã‚«ãƒ†ã‚´ãƒªãƒ¼

#### å…¨ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®å–å¾—

**GET** `/categories`

å…¨ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
[
    {
        "category_id": 1,
        "category_name": "è²·ã„ç‰©"
    },
    {
        "category_id": 2,
        "category_name": "è¡£é¡"
    },
    {
        "category_id": 3,
        "category_name": "ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°"
    },
    {
        "category_id": 4,
        "category_name": "æ—…è¡Œ"
    },
    {
        "category_id": 5,
        "category_name": "å¤–é£Ÿ"
    },
    {
        "category_id": 6,
        "category_name": "å¥åº·"
    },
    {
        "category_id": 7,
        "category_name": "äº¤é€š"
    }
]
```

### ãƒ¡ãƒ³ãƒãƒ¼

#### ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®å–å¾—

**GET** `/members/{member_id}/missions`

ç‰¹å®šã®ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆ`member_id`ï¼‰ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

- 200: ãƒ¡ãƒ³ãƒãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’å«ã‚€ JSON é…åˆ—
- 500: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

#### ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°

**PATCH** `/members/{member_id}/missions/{mission_id}`

ç‰¹å®šã®ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆ`member_id`ï¼‰ãŠã‚ˆã³ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼ˆ`mission_id`ï¼‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£:**

- `is_completed`: å®Œäº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆå¿…é ˆï¼‰

```JSON
{
    "is_completed": true
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
{
    "updatedMission": {
        "member_mission_id": 5,
        "is_completed": 1,
        "mission_id": 5,
        "mission_title": "ã‚³ãƒ³ãƒ“ãƒ‹é£Ÿå“ç¦æ­¢ãƒãƒ£ãƒ¬ãƒ³ã‚¸",
        "mission_description": "è‡ªç‚Šã‚’è¡Œãˆã‚‹æ™‚é–“ãŒç„¡ã„æ™‚ã¯ç´è±†ã‚„è±†è…ã¨ã„ã£ãŸæ‰‹é–“ãŒã‹ã‹ã‚‰ãªã„æ–™ç†ã§æ¸ˆã¾ã›ã‚‹",
        "exp_point": 300
    },
    "currentRankpoint": 700
}
```

æ—¢ã«å®Œäº†ã—ãŸå ´åˆ

```JSON
{
    "message": "Mission is already completed."
}
```

#### ãƒ¡ãƒ³ãƒãƒ¼ã®çµŒé¨“å€¤ã®å–å¾—

**GET** `/members/{member_id}/exp`

ç‰¹å®šã®ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆ`member_id`ï¼‰ã®çµŒé¨“å€¤ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```JSON
{
    "rankpoint": 700
}

```

## ç’°å¢ƒå¤‰æ•°

- `DB_HOST`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ›ã‚¹ãƒˆ
- `DB_USER`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼
- `DB_PASSWORD`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
- `DB_DATABASE`: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å

## ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```
npm start
```

ã‚µãƒ¼ãƒãƒ¼ã¯ãƒãƒ¼ãƒˆ`3000`ã§ç¨¼åƒã—ã¾ã™ã€‚

## ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

å…¨ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€`500`ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
